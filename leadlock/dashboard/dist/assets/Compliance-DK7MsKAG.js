import{c as w,r as x,j as t,f as v,U as L}from"./index-BHeaMpcx.js";import{a as C}from"./client-CM7usSQg.js";import{P as T}from"./PageHeader-B70tmnmd.js";import{B as A}from"./Badge-CMg_OOW7.js";import{C as b}from"./circle-alert-CrLVGEbj.js";import{C as N}from"./circle-x-DCbRSBO6.js";import{C as j}from"./clock-YShVbrww.js";import{C as q}from"./chevron-up-B8rptYAu.js";import{C as P}from"./chevron-down-BThlQuyw.js";import{C as F}from"./circle-check-CZ_JZGx6.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=w("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=w("ShieldX",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]),E={green:{icon:v,title:"Compliant",description:"All TCPA compliance checks are passing.",bg:"bg-emerald-50",border:"border-emerald-200",iconColor:"text-emerald-600",titleColor:"text-emerald-700"},yellow:{icon:$,title:"Warning",description:"Some compliance metrics need attention.",bg:"bg-amber-50",border:"border-amber-200",iconColor:"text-amber-600",titleColor:"text-amber-700"},red:{icon:y,title:"Action Required",description:"Compliance violations detected. Immediate action required.",bg:"bg-red-50",border:"border-red-200",iconColor:"text-red-600",titleColor:"text-red-700"}},I={green:"text-gray-900",yellow:"text-amber-600",red:"text-red-600"};function te(){const[e,l]=x.useState(null),[i,c]=x.useState(!0),[r,a]=x.useState(null),[p,o]=x.useState(null),[f,g]=x.useState(null),[h,n]=x.useState(!1);x.useEffect(()=>{u()},[]);const u=async()=>{try{const s=await C.getComplianceSummary();l(s),a(null)}catch(s){console.error("Failed to load compliance:",s),a(s.message||"Unknown error")}finally{c(!1)}},k=async s=>{if(p===s){o(null),g(null);return}o(s),n(!0);try{const _=await C.getComplianceDetails(s);g(_)}catch(_){g({items:[],error:_.message})}finally{n(!1)}};if(i)return t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"w-6 h-6 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})});const S=U(e),d=E[S],m=d.icon,M=(e==null?void 0:e.total_consent_records)>0?(e.opted_out_count/e.total_consent_records*100).toFixed(1):"0.0",O=V(e,M),R=B(e);return t.jsxs("div",{children:[t.jsx(T,{title:"TCPA Compliance"}),r&&t.jsxs("div",{className:"mb-6 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60 text-red-600 text-sm flex items-center gap-2",children:[t.jsx(b,{className:"w-4 h-4 flex-shrink-0"}),"Failed to load compliance data. ",t.jsx("button",{onClick:()=>{a(null),u()},className:"underline font-medium cursor-pointer",children:"Retry"})]}),t.jsx("div",{className:`rounded-2xl p-6 mb-8 border ${d.bg} ${d.border}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(m,{className:`w-6 h-6 ${d.iconColor}`}),t.jsxs("div",{children:[t.jsx("p",{className:`text-base font-semibold ${d.titleColor}`,children:d.title}),t.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:d.description})]})]})}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:O.map(s=>t.jsx(z,{...s,expanded:p===s.key,onClick:()=>k(s.key),drillDownData:p===s.key?f:null,drillDownLoading:p===s.key&&h},s.key))}),t.jsx(Q,{items:R}),(e==null?void 0:e.last_audit)&&t.jsxs("p",{className:"text-xs text-gray-400 mt-6",children:["Last audit: ",new Date(e.last_audit).toLocaleString()]})]})}function U(e){return e?e.cold_outreach_violations>0||e.messages_in_quiet_hours>0?"red":e.opted_out_count>0&&e.total_consent_records>0&&e.opted_out_count/e.total_consent_records>.1?"yellow":"green":"yellow"}function V(e,l){const i=((e==null?void 0:e.messages_in_quiet_hours)||0)>0?"red":"green",c=((e==null?void 0:e.cold_outreach_violations)||0)>0?"red":"green",r=(e==null?void 0:e.total_consent_records)>0&&e.opted_out_count/e.total_consent_records>.1?"yellow":"green";return[{key:"consent",label:"Consent Records",value:(e==null?void 0:e.total_consent_records)||0,subtitle:"Total active consent records on file",icon:L,status:"green"},{key:"opt_out",label:"Opt-Out Count",value:(e==null?void 0:e.opted_out_count)||0,subtitle:"Contacts who opted out of messaging",icon:N,status:((e==null?void 0:e.opted_out_count)||0)>0?"yellow":"green"},{key:"quiet_hours",label:"Quiet Hours Violations",value:(e==null?void 0:e.messages_in_quiet_hours)||0,subtitle:"Messages sent outside allowed hours",icon:j,status:i},{key:"cold_outreach",label:"Cold Outreach Violations",value:(e==null?void 0:e.cold_outreach_violations)||0,subtitle:"Messages exceeding per-lead limits",icon:b,status:c},{key:"pending_followups",label:"Pending Follow-ups",value:(e==null?void 0:e.pending_followups)||0,subtitle:"Queued follow-up messages",icon:j,status:"green"},{key:"opt_out_rate",label:"Opt-Out Rate",value:`${l}%`,subtitle:"Percentage of contacts who opted out",icon:v,status:r}]}function B(e){return e?[{label:"Consent records retained (5-year FTC TSR 2024)",status:e.total_consent_records>0?"pass":"warn"},{label:"Opt-out processing active",status:"pass"},{label:"AI disclosure included (California SB 1001)",status:e.messages_with_ai_disclosure!=null?"pass":"warn"},{label:"Quiet hours enforcement (state-specific)",status:(e.messages_in_quiet_hours||0)===0?"pass":"fail"},{label:"Business name in first message",status:"pass"},{label:"STOP opt-out in first message",status:"pass"}]:[]}function z({label:e,value:l,subtitle:i,icon:c,status:r,expanded:a,onClick:p,drillDownData:o,drillDownLoading:f}){var h;const g=I[r]||"text-gray-900";return t.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl shadow-card overflow-hidden",children:[t.jsxs("button",{onClick:p,className:"w-full text-left p-6 cursor-pointer hover:bg-gray-50/50 transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(c,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:e})]}),a?t.jsx(q,{className:"w-4 h-4 text-gray-400"}):t.jsx(P,{className:"w-4 h-4 text-gray-400"})]}),t.jsx("p",{className:`text-2xl font-bold font-mono ${g}`,children:l}),t.jsx("p",{className:"text-xs text-gray-400 mt-1.5",children:i})]}),a&&t.jsx("div",{className:"border-t border-gray-100 px-6 py-4 bg-gray-50/50 max-h-48 overflow-y-auto",children:f?t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"}),"Loading details..."]}):o!=null&&o.error?t.jsx("p",{className:"text-xs text-gray-400",children:o.error}):((h=o==null?void 0:o.items)==null?void 0:h.length)>0?t.jsx("div",{className:"space-y-2",children:o.items.map((n,u)=>t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsx("span",{className:"text-gray-600 truncate",children:n.phone_masked||n.lead_name||`Record ${u+1}`}),t.jsx("span",{className:"text-gray-400 font-mono ml-2 flex-shrink-0",children:n.date||n.created_at?new Date(n.date||n.created_at).toLocaleDateString():""})]},n.id||u))}):t.jsx("p",{className:"text-xs text-gray-400",children:"No details available"})})]})}function Q({items:e}){const l={pass:t.jsx(F,{className:"w-5 h-5 text-emerald-500 flex-shrink-0"}),fail:t.jsx(N,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),warn:t.jsx(b,{className:"w-5 h-5 text-amber-500 flex-shrink-0"}),warning:t.jsx(b,{className:"w-5 h-5 text-amber-500 flex-shrink-0"})},i={pass:"success",fail:"danger",warn:"warning",warning:"warning"},c={pass:"Pass",fail:"Fail",warn:"Warning",warning:"Warning"};return t.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-5",children:"Compliance Checklist"}),t.jsx("div",{children:e.map(({label:r,status:a})=>t.jsxs("div",{className:"flex items-center gap-3 py-3 border-b border-gray-100 last:border-0",children:[l[a],t.jsx("span",{className:"text-sm text-gray-700 flex-1",children:r}),t.jsx(A,{variant:i[a],size:"sm",children:c[a]})]},r))})]})}export{te as default};
