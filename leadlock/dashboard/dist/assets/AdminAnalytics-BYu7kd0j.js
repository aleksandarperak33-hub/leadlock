import{r as o,j as e,T as L,C as R,Z as B,D as M}from"./index-C6CvHDG0.js";import{a as m}from"./client-BPQvj84Y.js";import{P as V}from"./PageHeader-BjaxPPSz.js";import{F as k}from"./FunnelChart-AW39A6X6.js";import{C as I}from"./circle-alert-CQ0yiEZR.js";import{F as O}from"./flask-conical-CMHnCdj6.js";function u({title:t,icon:a,children:r}){return e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-orange-50 flex items-center justify-center",children:e.jsx(a,{className:"w-4 h-4 text-orange-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t})]}),r]})}function b({label:t,value:a,numericValue:r,maxValue:n,suffix:l=""}){const d=typeof r=="number"?r:Number(r||0),c=n>0?Math.round(d/n*100):0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-700 w-40 shrink-0 truncate",children:t}),e.jsx("div",{className:"flex-1 h-3 rounded-full overflow-hidden bg-orange-100",children:e.jsx("div",{className:"h-full bg-orange-500 rounded-full transition-all duration-500",style:{width:`${Math.max(c,2)}%`}})}),e.jsxs("span",{className:"text-sm font-mono text-gray-900 w-20 text-right",children:[a,l]})]})}function D({tests:t}){return!t||t.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"No A/B tests running."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 pb-2",children:"Test"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-500 pb-2",children:"Variant A"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-500 pb-2",children:"Variant B"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-500 pb-2",children:"Winner"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:t.map((a,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-gray-700 max-w-[180px] truncate",children:a.name||a.subject||`Test ${r+1}`}),e.jsx("td",{className:"py-2 text-right font-mono text-gray-600",children:a.variant_a_rate!=null?`${(a.variant_a_rate*100).toFixed(1)}%`:"—"}),e.jsx("td",{className:"py-2 text-right font-mono text-gray-600",children:a.variant_b_rate!=null?`${(a.variant_b_rate*100).toFixed(1)}%`:"—"}),e.jsx("td",{className:"py-2 text-right",children:a.winner?e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded-md bg-emerald-50 text-emerald-700",children:a.winner}):e.jsx("span",{className:"text-xs text-gray-400",children:"Running"})})]},a.id||r))})]})})}function W({data:t}){if(!t)return e.jsx("p",{className:"text-sm text-gray-400",children:"No data available."});const a=Array.isArray(t)?t:Object.entries(t).map(([n,l])=>({trade:n,cost:Number(l)||0}));if(a.length===0)return e.jsx("p",{className:"text-sm text-gray-400",children:"No data available."});const r=Math.max(...a.map(n=>Number(n.cost||0)),.01);return e.jsx("div",{className:"space-y-3",children:a.map((n,l)=>{const d=Number(n.cost||0);return e.jsx(b,{label:n.trade||"Overall",value:`$${d.toFixed(2)}`,numericValue:d,maxValue:r},n.trade||l)})})}function h(t){return t&&typeof t=="object"&&"data"in t?t.data:t}function K(){const[t,a]=o.useState(null),[r,n]=o.useState(null),[l,d]=o.useState(null),[c,C]=o.useState(null),[F,P]=o.useState(null),[_,y]=o.useState(!0),[N,v]=o.useState(null);o.useEffect(()=>{A()},[]);const A=async()=>{y(!0),v(null);try{const[s,i,x,p,j]=await Promise.allSettled([m.getAnalyticsPipeline(),m.getAnalyticsEmailPerf(),m.getAnalyticsAbTests(),m.getAnalyticsAgentCosts(),m.getAnalyticsCostPerLead()]);if(s.status==="fulfilled"&&a(h(s.value)),i.status==="fulfilled"&&n(h(i.value)),x.status==="fulfilled"&&d(h(x.value)),p.status==="fulfilled"&&C(h(p.value)),j.status==="fulfilled"&&P(h(j.value)),[s,i,x,p,j].every(E=>E.status==="rejected"))throw new Error("All analytics endpoints failed.")}catch(s){v(s.message||"Failed to load analytics.")}finally{y(!1)}};if(_)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-6 h-6 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})});const f=(r==null?void 0:r.steps)||[],S=Math.max(...f.map(s=>Number(s.open_rate||0)),.01),g=c!=null&&c.total_by_agent?Object.entries(c.total_by_agent).map(([s,i])=>({agent:s,cost:Number(i)||0})):[],$=Math.max(...g.map(s=>s.cost),.01),T=Array.isArray(l)?l:(l==null?void 0:l.experiments)||(l?[l]:[]),w=(t==null?void 0:t.stages)||t;return e.jsxs("div",{className:"min-h-screen bg-[#FAFAFA]",children:[e.jsx(V,{title:"Analytics",subtitle:"Pipeline, email performance, A/B tests, and costs"}),N&&e.jsxs("div",{className:"mb-4 flex items-center gap-3 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60",children:[e.jsx(I,{className:"w-4 h-4 text-red-500 shrink-0"}),e.jsx("p",{className:"text-sm text-red-700 flex-1",children:N}),e.jsx("button",{onClick:A,className:"text-xs font-medium text-red-600 hover:text-red-800 cursor-pointer",children:"Retry"})]}),w&&e.jsx(u,{title:"Pipeline Waterfall",icon:L,children:e.jsx(k,{stages:w})}),f.length>0&&e.jsx(u,{title:"Email Performance by Step",icon:R,children:e.jsx("div",{className:"space-y-3",children:f.map((s,i)=>{const x=Number(s.open_rate||0);return e.jsx(b,{label:`Step ${s.step??i+1}`,value:`${(x*100).toFixed(1)}%`,numericValue:x,maxValue:S},s.step??i)})})}),e.jsx(u,{title:"A/B Test Results",icon:O,children:e.jsx(D,{tests:T})}),g.length>0&&e.jsx(u,{title:"Agent Costs (Last 7 Days)",icon:B,children:e.jsx("div",{className:"space-y-3",children:g.map((s,i)=>e.jsx(b,{label:s.agent||`Agent ${i+1}`,value:`$${s.cost.toFixed(4)}`,numericValue:s.cost,maxValue:$},s.agent||i))})}),c&&e.jsxs("div",{className:"mb-6 text-right text-sm text-gray-500 font-mono",children:["Total AI spend (7d): $",Number(c.total_usd||0).toFixed(4)]}),e.jsx(u,{title:"Cost Per Lead by Trade",icon:M,children:e.jsx(W,{data:F})})]})}export{K as default};
