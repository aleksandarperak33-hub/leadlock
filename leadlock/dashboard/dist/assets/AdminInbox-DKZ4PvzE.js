import{c as T,r as a,j as e,T as A,p as V,S as F,M as B,B as W,h as X}from"./index-BHeaMpcx.js";import{a as p}from"./client-CM7usSQg.js";import{P as G}from"./PageHeader-B70tmnmd.js";import{B as j}from"./Badge-CMg_OOW7.js";import{S as J}from"./SearchInput-Cd1-TkF5.js";import{M as K}from"./map-pin-HuyXKHLt.js";import{P as Q}from"./phone-DNdX0wKk.js";import{C as Y}from"./circle-check-CZ_JZGx6.js";import{C as Z}from"./circle-x-DCbRSBO6.js";import{B as ee}from"./ban-DgpFA4rf.js";import{E as se}from"./eye-DHifOSUs.js";import{C as te}from"./clock-YShVbrww.js";import"./search-DnPY5eD6.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=T("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=T("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),ne={cold:"neutral",contacted:"info",demo_scheduled:"warning",won:"success",lost:"danger"},le=[{id:"all",label:"All"},{id:"replies",label:"Replies"},{id:"sent",label:"Sent Only"}];function ie(s){if(!s)return"";const r=Date.now()-new Date(s).getTime(),n=Math.floor(r/6e4);if(n<1)return"just now";if(n<60)return`${n}m ago`;const c=Math.floor(n/60);if(c<24)return`${c}h ago`;const i=Math.floor(c/24);return i<7?`${i}d ago`:new Date(s).toLocaleDateString()}function oe({conv:s,isActive:r,onSelect:n}){const c=s.reply_count>0;return e.jsx("button",{onClick:()=>n(s.prospect_id),className:`w-full text-left px-4 py-3 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${r?"bg-orange-50/50 border-l-2 border-l-orange-500":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.unread&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500 shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:s.prospect_name}),s.campaign_name&&e.jsx(j,{variant:"warning",size:"sm",children:s.campaign_name}),!c&&e.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-gray-100 text-gray-500",children:"No replies yet"})]}),s.prospect_company&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:s.prospect_company}),e.jsx("p",{className:"text-xs text-gray-400 truncate mt-0.5",children:s.last_reply_snippet||"No preview available"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 ml-3 shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-400 font-mono whitespace-nowrap",children:ie(s.last_activity_at||s.last_inbound_at||s.last_outbound_at)}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.sent_count>0&&e.jsxs("span",{className:"flex items-center gap-0.5 text-xs text-gray-400 font-mono",children:[e.jsx(F,{className:"w-3 h-3"})," ",s.sent_count]}),c&&e.jsxs("span",{className:"flex items-center gap-0.5 text-xs text-orange-500 font-mono",children:[e.jsx(B,{className:"w-3 h-3"})," ",s.reply_count]})]})]})]})})}function ce({prospect:s,onStatusChange:r,onBlacklist:n}){return e.jsx("div",{className:"px-5 py-4 border-b border-gray-200/50 bg-white shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx(j,{variant:ne[s.status]||"neutral",children:s.status}),s.campaign_name&&e.jsx(j,{variant:"warning",size:"sm",children:s.campaign_name})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1.5",children:[s.company&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(W,{className:"w-3 h-3"})," ",s.company]}),s.trade_type&&e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:s.trade_type}),(s.city||s.state_code)&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(K,{className:"w-3 h-3"})," ",[s.city,s.state_code].filter(Boolean).join(", ")]}),s.email&&e.jsx("span",{className:"text-xs text-gray-400 font-mono",children:s.email}),s.phone&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Q,{className:"w-3 h-3"})," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>r("won"),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium text-emerald-700 bg-emerald-50 border border-emerald-200/60 hover:bg-emerald-100 transition-colors cursor-pointer",children:[e.jsx(Y,{className:"w-3 h-3"})," Won"]}),e.jsxs("button",{onClick:()=>r("lost"),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium text-red-600 bg-red-50 border border-red-200/60 hover:bg-red-100 transition-colors cursor-pointer",children:[e.jsx(Z,{className:"w-3 h-3"})," Lost"]}),e.jsx("button",{onClick:n,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-medium text-gray-500 bg-white border border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer",children:e.jsx(ee,{className:"w-3 h-3"})})]})]})})}function de({email:s}){const r=s.direction==="outbound";return e.jsxs("div",{className:`rounded-xl border p-4 mb-3 ${r?"bg-orange-50/30 border-orange-200/40":"bg-white border-gray-200/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r?e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-gray-500",children:[e.jsx(F,{className:"w-3 h-3"})," Sent"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-orange-600",children:[e.jsx(B,{className:"w-3 h-3"})," Reply"]}),s.sequence_step>0&&e.jsxs(j,{variant:"neutral",size:"sm",children:["Step ",s.sequence_step]}),r&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[s.opened_at&&e.jsxs("span",{className:"flex items-center gap-0.5 text-xs text-emerald-600",children:[e.jsx(se,{className:"w-3 h-3"})," Opened"]}),s.clicked_at&&e.jsxs("span",{className:"flex items-center gap-0.5 text-xs text-blue-600",children:[e.jsx(X,{className:"w-3 h-3"})," Clicked"]}),s.bounced_at&&e.jsxs("span",{className:"flex items-center gap-0.5 text-xs text-red-600",children:[e.jsx(A,{className:"w-3 h-3"})," Bounced"]})]})]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 font-mono",children:[e.jsx(te,{className:"w-3 h-3"}),s.sent_at?new Date(s.sent_at).toLocaleString():"--"]})]}),s.subject&&e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:s.subject}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed whitespace-pre-wrap",children:s.body_text||(s.body_html?s.body_html.replace(/<[^>]+>/g,""):"(no content)")})]})}function _e(){const[s,r]=a.useState([]),[n,c]=a.useState(0),[i,I]=a.useState({total_conversations:0,with_replies:0,without_replies:0}),[d,h]=a.useState(1),[M,N]=a.useState(!0),[w,v]=a.useState(null),[g,L]=a.useState(""),[o,P]=a.useState("all"),[$,E]=a.useState([]),[u,R]=a.useState(""),[x,b]=a.useState(null),[f,y]=a.useState(null),[z,_]=a.useState(!1),m=a.useCallback(async()=>{try{N(!0),v(null);const t={page:d,per_page:25,filter:o};g&&(t.campaign_id=g);const l=await p.getInbox(t);r(l.conversations||[]),c(l.total||0),I({total_conversations:l.total_conversations??0,with_replies:l.with_replies??0,without_replies:l.without_replies??0})}catch{v("Failed to load inbox. Please try again."),r([])}finally{N(!1)}},[d,g,o]),C=a.useCallback(async()=>{try{const t=await p.getCampaigns();E(t.campaigns||[])}catch{}},[]),S=a.useCallback(async t=>{_(!0);try{const l=await p.getInboxThread(t);y(l)}catch{y(null)}finally{_(!1)}},[]);a.useEffect(()=>{m(),C()},[m,C]);const D=t=>{b(t),S(t)},q=t=>{P(t),h(1),b(null),y(null)},H=async t=>{if(x)try{await p.updateProspect(x,{status:t}),m(),S(x)}catch(l){console.error("Status update failed:",l)}},O=async()=>{if(!(!x||!confirm("Blacklist this prospect? They will not receive further emails.")))try{await p.blacklistProspect(x),m(),b(null),y(null)}catch(t){console.error("Blacklist failed:",t)}},k=u?s.filter(t=>(t.prospect_name||"").toLowerCase().includes(u.toLowerCase())||(t.prospect_company||"").toLowerCase().includes(u.toLowerCase())):s,U=o==="all"?`${i.total_conversations} conversations`:o==="replies"?`${i.with_replies} with replies`:`${i.without_replies} awaiting reply`;return e.jsxs("div",{className:"min-h-screen bg-[#FAFAFA]",children:[e.jsx(G,{title:"Inbox",subtitle:U}),e.jsx("div",{className:"flex items-center gap-1 mb-4",children:le.map(t=>{const l=t.id==="all"?i.total_conversations:t.id==="replies"?i.with_replies:i.without_replies;return e.jsxs("button",{onClick:()=>q(t.id),className:`px-3.5 py-1.5 rounded-lg text-sm font-medium transition-colors cursor-pointer ${o===t.id?"bg-orange-50 text-orange-600 border border-orange-200/60":"text-gray-500 hover:bg-gray-50 border border-transparent"}`,children:[t.label,e.jsx("span",{className:"ml-1.5 text-xs font-mono opacity-70",children:l})]},t.id)})}),w&&e.jsxs("div",{className:"mb-4 flex items-center gap-3 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60",children:[e.jsx(A,{className:"w-4 h-4 text-red-500 shrink-0"}),e.jsx("p",{className:"text-sm text-red-700 flex-1",children:w}),e.jsx("button",{onClick:m,className:"text-xs font-medium text-red-600 hover:text-red-800 cursor-pointer",children:"Retry"})]}),e.jsxs("div",{className:"flex bg-white border border-gray-200/50 rounded-2xl shadow-card overflow-hidden",style:{height:"calc(100vh - 260px)"},children:[e.jsxs("div",{className:"w-[360px] border-r border-gray-200/50 flex flex-col shrink-0",children:[e.jsxs("div",{className:"p-3 border-b border-gray-100 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-3.5 h-3.5 text-gray-400 shrink-0"}),e.jsxs("select",{value:g,onChange:t=>{L(t.target.value),h(1)},className:"w-full px-2.5 py-1.5 bg-white border border-gray-200 rounded-lg text-xs text-gray-700 outline-none focus:border-orange-500 cursor-pointer",children:[e.jsx("option",{value:"",children:"All Campaigns"}),$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx(J,{value:u,onChange:R,placeholder:"Search conversations..."})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:M?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"w-5 h-5 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})}):k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[e.jsx(re,{className:"w-10 h-10 text-gray-300 mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:o==="replies"?"No replies yet":o==="sent"?"No sent emails":"No conversations"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:o==="replies"?"Check back when prospects respond to your outreach.":o==="sent"?"Sent emails awaiting reply will appear here.":"Start a campaign to see conversations here."})]}):k.map(t=>e.jsx(oe,{conv:t,isActive:x===t.prospect_id,onSelect:D},t.prospect_id))}),n>25&&e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>h(Math.max(1,d-1)),disabled:d===1,className:"px-2.5 py-1 rounded-lg text-xs text-gray-500 bg-gray-50 disabled:opacity-40 cursor-pointer",children:"Prev"}),e.jsxs("span",{className:"text-xs text-gray-400 font-mono",children:[d,"/",Math.ceil(n/25)]}),e.jsx("button",{onClick:()=>h(d+1),disabled:d>=Math.ceil(n/25),className:"px-2.5 py-1 rounded-lg text-xs text-gray-500 bg-gray-50 disabled:opacity-40 cursor-pointer",children:"Next"})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:x?z?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-5 h-5 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})}):f?e.jsxs(e.Fragment,{children:[e.jsx(ce,{prospect:f.prospect,onStatusChange:H,onBlacklist:O}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4",children:[(f.emails||[]).map(t=>e.jsx(de,{email:t},t.id)),(f.emails||[]).length===0&&e.jsx("p",{className:"text-sm text-gray-400 text-center py-12",children:"No emails in this thread."})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-sm text-gray-400",children:"Failed to load thread."})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(V,{className:"w-12 h-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Select a conversation"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Click on a prospect to view their email thread."})]})})]})]})}export{_e as default};
