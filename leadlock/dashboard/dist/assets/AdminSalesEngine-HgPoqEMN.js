import{j as e,X as D,r as i,Z as xe,p as me}from"./index-BHeaMpcx.js";import{a as y}from"./client-CM7usSQg.js";import{P as pe}from"./PageHeader-B70tmnmd.js";import{S as f}from"./StatCard-CoJTE6us.js";import{B as v}from"./Badge-CMg_OOW7.js";import{D as I}from"./DataTable-2VHuwdQk.js";import{T as ue}from"./Tabs-D_nwivGe.js";import{S as ge}from"./SearchInput-Cd1-TkF5.js";import{S as M}from"./StatusDot-BOoImejg.js";import{P as he}from"./plus-uTLkigTW.js";import{P as ye}from"./play-PIJ_1fDL.js";import{T as be}from"./trash-2-BHMdR2CX.js";import{B as je}from"./ban-DgpFA4rf.js";import"./chevron-down-BThlQuyw.js";import"./chevron-up-B8rptYAu.js";import"./search-DnPY5eD6.js";const fe=["hvac","plumbing","roofing","electrical","solar","general"],P="bg-white border border-gray-200 text-gray-900 outline-none focus:border-orange-400 focus:ring-2 focus:ring-orange-100 transition-all";function ve({config:s,onConfigChange:l,newLocation:t,onNewLocationChange:n,onAddLocation:u,onRemoveLocation:a,onToggleTradeType:o,onSave:b,saving:p}){return s?e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Target Locations"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(s.target_locations||[]).map((c,m)=>e.jsxs("span",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs bg-gray-50 text-gray-600 border border-gray-200/50 font-medium",children:[c.city,", ",c.state,e.jsx("button",{onClick:()=>a(m),className:"ml-0.5 text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx(D,{className:"w-3 h-3"})})]},m))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t.city,onChange:c=>n({...t,city:c.target.value}),className:`flex-1 px-3 py-2.5 rounded-xl text-sm ${P}`,placeholder:"City"}),e.jsx("input",{type:"text",value:t.state,onChange:c=>n({...t,state:c.target.value.toUpperCase().slice(0,2)}),className:`w-16 px-3 py-2.5 rounded-xl text-sm ${P}`,placeholder:"ST",maxLength:2}),e.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-4 py-2.5 rounded-xl text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 cursor-pointer transition-colors",children:[e.jsx(he,{className:"w-3.5 h-3.5"})," Add"]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Target Trade Types"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(c=>{const m=(s.target_trade_types||[]).includes(c);return e.jsx("button",{onClick:()=>o(c),className:`px-4 py-2 rounded-xl text-sm font-medium capitalize transition-all cursor-pointer ${m?"bg-orange-50 text-orange-700 border border-orange-200/60":"bg-white text-gray-500 border border-gray-200 hover:border-gray-300"}`,children:c},c)})})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Rate Limits"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Daily Emails",key:"daily_email_limit"},{label:"Daily Scrapes",key:"daily_scrape_limit"},{label:"Delay (hours)",key:"sequence_delay_hours"},{label:"Max Steps",key:"max_sequence_steps"}].map(({label:c,key:m})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:c}),e.jsx("input",{type:"number",value:s[m]||"",onChange:h=>{const g=h.target.value;l({...s,[m]:g===""?"":parseInt(g)||0})},className:`w-full px-3 py-2.5 rounded-xl text-sm font-mono ${P}`})]},m))})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Sender Config"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{label:"From Email",key:"from_email",placeholder:"outreach@leadlock.io"},{label:"From Name",key:"from_name",placeholder:"LeadLock"},{label:"Reply-To Email",key:"reply_to_email",placeholder:"alex@leadlock.io"},{label:"Company Address",key:"company_address",placeholder:"123 Main St, Austin, TX 78701"}].map(({label:c,key:m,placeholder:h})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:c}),e.jsx("input",{type:"text",value:s[m]||"",onChange:g=>l({...s,[m]:g.target.value}),className:`w-full px-3 py-2.5 rounded-xl text-sm ${P}`,placeholder:h})]},m))})]}),e.jsx("button",{onClick:b,disabled:p,className:"px-6 py-2.5 rounded-xl text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 transition-colors disabled:opacity-50 cursor-pointer",children:p?"Saving...":"Save Settings"})]}):null}const U=["hvac","plumbing","roofing","electrical","solar","general"],Ne=["cold","contacted","demo_scheduled","demo_completed","proposal_sent","won","lost"],w="bg-white border border-gray-200 text-gray-900 outline-none focus:border-orange-400 focus:ring-2 focus:ring-orange-100 transition-all",_e={pending:"neutral",running:"warning",completed:"success",failed:"danger"},we={cold:"neutral",contacted:"info",demo_scheduled:"warning",demo_completed:"warning",proposal_sent:"warning",won:"success",lost:"danger"},Se={cold:"gray",contacted:"yellow",demo_scheduled:"yellow",demo_completed:"yellow",proposal_sent:"yellow",won:"green",lost:"red"},ke={healthy:"green",warning:"yellow",unhealthy:"red",unknown:"gray"};function A(s){return(s||"").replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())}function Te({show:s,form:l,onChange:t,onSubmit:n,onClose:u,scraping:a}){return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"w-full max-w-sm bg-white border border-gray-200/50 rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Run Manual Scrape"}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"City"}),e.jsx("input",{type:"text",value:l.city,onChange:o=>t({...l,city:o.target.value}),className:`w-full px-3 py-2.5 rounded-xl text-sm ${w}`,placeholder:"Austin"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"State"}),e.jsx("input",{type:"text",value:l.state,onChange:o=>t({...l,state:o.target.value.toUpperCase().slice(0,2)}),className:`w-full px-3 py-2.5 rounded-xl text-sm ${w}`,placeholder:"TX",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"Trade Type"}),e.jsx("select",{value:l.trade_type,onChange:o=>t({...l,trade_type:o.target.value}),className:`w-full px-3 py-2.5 rounded-xl text-sm cursor-pointer ${w}`,children:U.map(o=>e.jsx("option",{value:o,children:o.charAt(0).toUpperCase()+o.slice(1)},o))})]}),e.jsx("button",{onClick:n,disabled:a||!l.city||!l.state,className:"w-full py-2.5 rounded-xl text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 transition-colors disabled:opacity-50 cursor-pointer",children:a?"Scraping...":"Start Scrape"})]})]})}):null}function Ce({metrics:s}){var l,t,n,u,a,o,b,p,c,m,h,g;return s?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(f,{label:"Prospects Scraped",value:((l=s.prospects)==null?void 0:l.total)||0}),e.jsx(f,{label:"Emails Sent",value:((t=s.emails)==null?void 0:t.sent)||0}),e.jsx(f,{label:"Open Rate",value:`${((n=s.emails)==null?void 0:n.open_rate)||0}%`,color:((u=s.emails)==null?void 0:u.open_rate)>20?"green":"yellow"}),e.jsx(f,{label:"Reply Rate",value:`${((a=s.emails)==null?void 0:a.reply_rate)||0}%`,color:((o=s.emails)==null?void 0:o.reply_rate)>5?"green":"yellow"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(f,{label:"Demos Booked",value:((b=s.conversions)==null?void 0:b.demos_booked)||0,color:"brand"}),e.jsx(f,{label:"Won",value:((p=s.conversions)==null?void 0:p.won)||0,color:"green"}),e.jsx(f,{label:"Total Cost",value:`$${((c=s.cost)==null?void 0:c.total)||0}`}),e.jsx(f,{label:"Bounced",value:((m=s.emails)==null?void 0:m.bounced)||0,color:((h=s.emails)==null?void 0:h.bounced)>0?"red":"brand"})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-4",children:"Pipeline Breakdown"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:Object.entries(((g=s.prospects)==null?void 0:g.by_status)||{}).map(([d,E])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{color:Se[d]||"gray"}),e.jsx("span",{className:"text-sm capitalize text-gray-600",children:A(d)}),e.jsx("span",{className:"text-sm font-mono font-medium text-gray-900",children:E})]},d))})]})]}):null}function Pe({prospects:s,prospectsTotal:l,prospectsPage:t,prospectsFilter:n,onFilterChange:u,onPageChange:a,selectedProspect:o,prospectEmails:b,onSelectProspect:p,onCloseDetail:c,onDeleteProspect:m,onBlacklistProspect:h,maxSequenceSteps:g}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[220px]",children:e.jsx(ge,{value:n.search,onChange:d=>{u({...n,search:d}),a(1)},placeholder:"Search name, company, email..."})}),e.jsxs("select",{value:n.status,onChange:d=>{u({...n,status:d.target.value}),a(1)},className:`px-3 py-2.5 rounded-xl text-sm cursor-pointer ${w}`,children:[e.jsx("option",{value:"",children:"All Statuses"}),Ne.map(d=>e.jsx("option",{value:d,children:A(d)},d))]}),e.jsxs("select",{value:n.trade_type,onChange:d=>{u({...n,trade_type:d.target.value}),a(1)},className:`px-3 py-2.5 rounded-xl text-sm cursor-pointer ${w}`,children:[e.jsx("option",{value:"",children:"All Trades"}),U.map(d=>e.jsx("option",{value:d,children:d.charAt(0).toUpperCase()+d.slice(1)},d))]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:`${o?"flex-1":"w-full"}`,children:[e.jsx(Ae,{prospects:s,selectedId:o==null?void 0:o.id,onSelect:p,maxSteps:g}),l>25&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-400 font-mono",children:[l," total"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{disabled:t<=1,onClick:()=>a(t-1),className:"px-3 py-1.5 text-xs font-medium rounded-xl bg-white border border-gray-200 text-gray-600 hover:border-gray-300 disabled:opacity-40 cursor-pointer transition-colors",children:"Prev"}),e.jsx("span",{className:"px-2.5 py-1.5 text-xs font-mono text-gray-500",children:t}),e.jsx("button",{onClick:()=>a(t+1),className:"px-3 py-1.5 text-xs font-medium rounded-xl bg-white border border-gray-200 text-gray-600 hover:border-gray-300 cursor-pointer transition-colors",children:"Next"})]})]})]}),o&&e.jsx(Ee,{prospect:o,emails:b,onClose:c,onDelete:m,onBlacklist:h})]})]})}function Ae({prospects:s,selectedId:l,onSelect:t,maxSteps:n}){const u=[{key:"prospect_name",label:"Name",render:(a,o)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a}),o.prospect_company&&o.prospect_company!==a&&e.jsx("div",{className:"text-xs text-gray-400",children:o.prospect_company})]})},{key:"prospect_email",label:"Email",render:a=>e.jsx("span",{className:"text-gray-500",children:a||"—"})},{key:"prospect_trade_type",label:"Trade",render:a=>e.jsx("span",{className:"text-gray-500 capitalize",children:a})},{key:"status",label:"Status",render:a=>e.jsx(v,{variant:we[a]||"neutral",size:"sm",children:A(a)})},{key:"outreach_sequence_step",label:"Step",render:a=>e.jsxs("span",{className:"font-mono text-gray-500",children:[a,"/",n||3]})},{key:"last_email_opened_at",label:"Opened",render:a=>a?e.jsx("span",{className:"text-emerald-600 font-medium",children:"Yes"}):e.jsx("span",{className:"text-gray-400",children:"—"})},{key:"total_cost_usd",label:"Cost",align:"right",render:a=>e.jsxs("span",{className:"font-mono text-gray-500",children:["$",(a||0).toFixed(3)]})}];return e.jsx(I,{columns:u,data:s,emptyMessage:"No prospects found.",onRowClick:t})}function Ee({prospect:s,emails:l,onClose:t,onDelete:n,onBlacklist:u}){return e.jsxs("div",{className:"w-[400px] flex-shrink-0 bg-white border border-gray-200/50 rounded-2xl shadow-card overflow-y-auto",style:{maxHeight:"80vh"},children:[e.jsxs("div",{className:"p-5 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:s.prospect_name}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-500",children:[s.prospect_email&&e.jsxs("div",{children:["Email: ",s.prospect_email]}),s.prospect_phone&&e.jsxs("div",{children:["Phone: ",e.jsx("span",{className:"font-mono",children:s.prospect_phone})]}),s.website&&e.jsxs("div",{children:["Web: ",s.website]}),s.city&&e.jsxs("div",{children:["Location: ",s.city,", ",s.state_code]}),s.google_rating&&e.jsxs("div",{children:["Rating: ",e.jsxs("span",{className:"font-mono",children:[s.google_rating,"/5"]})," (",s.review_count," reviews)"]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>n(s.id),className:"flex items-center gap-1.5 px-3 py-2 rounded-xl text-xs font-medium bg-red-50 text-red-700 border border-red-200/60 hover:bg-red-100 cursor-pointer transition-colors",children:[e.jsx(be,{className:"w-3 h-3"})," Delete"]}),e.jsxs("button",{onClick:()=>u(s.id),className:"flex items-center gap-1.5 px-3 py-2 rounded-xl text-xs font-medium bg-gray-50 text-gray-600 border border-gray-200/50 hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsx(je,{className:"w-3 h-3"})," Blacklist"]})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-1.5",children:[e.jsx(me,{className:"w-3.5 h-3.5"})," Email Thread (",l.length,")"]}),l.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"No emails yet."}):e.jsx("div",{className:"space-y-3",children:l.map(a=>e.jsxs("div",{className:`rounded-xl p-4 border ${a.direction==="outbound"?"bg-white border-gray-200/50":"bg-orange-50/50 border-orange-200/60"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:`text-xs font-medium ${a.direction==="outbound"?"text-gray-500":"text-orange-600"}`,children:a.direction==="outbound"?`Step ${a.sequence_step} — Sent`:"Reply"}),e.jsx("span",{className:"text-xs text-gray-400 font-mono",children:a.sent_at?new Date(a.sent_at).toLocaleString():""})]}),e.jsx("p",{className:"text-sm font-medium mb-1 text-gray-900",children:a.subject}),e.jsxs("p",{className:"text-sm leading-relaxed text-gray-500",children:[a.body_text?a.body_text.slice(0,300):"",a.body_text&&a.body_text.length>300?"...":""]}),a.direction==="outbound"&&e.jsxs("div",{className:"flex gap-2 mt-2.5",children:[a.delivered_at&&e.jsx(v,{variant:"success",size:"sm",children:"Delivered"}),a.opened_at&&e.jsx(v,{variant:"info",size:"sm",children:"Opened"}),a.clicked_at&&e.jsx(v,{variant:"warning",size:"sm",children:"Clicked"}),a.bounced_at&&e.jsx(v,{variant:"danger",size:"sm",children:"Bounced"})]})]},a.id))})]})]})}function $e({scrapeJobs:s}){const l=[{key:"platform",label:"Platform",render:t=>e.jsx("span",{className:"text-gray-500 capitalize",children:(t||"").replace("_"," ")})},{key:"trade_type",label:"Trade",render:t=>e.jsx("span",{className:"text-gray-500 capitalize",children:t})},{key:"city",label:"Location",render:(t,n)=>e.jsxs("span",{className:"text-gray-900",children:[n.city,", ",n.state_code]})},{key:"status",label:"Status",render:t=>e.jsx(v,{variant:_e[t]||"neutral",size:"sm",children:A(t)})},{key:"results_found",label:"Found",align:"right",render:t=>e.jsx("span",{className:"font-mono",children:t})},{key:"new_prospects_created",label:"New",align:"right",render:t=>e.jsx("span",{className:"font-mono text-emerald-600",children:t})},{key:"duplicates_skipped",label:"Dupes",align:"right",render:t=>e.jsx("span",{className:"font-mono text-gray-400",children:t})},{key:"api_cost_usd",label:"Cost",align:"right",render:t=>e.jsxs("span",{className:"font-mono",children:["$",(t??0).toFixed(3)]})},{key:"created_at",label:"Date",render:t=>e.jsx("span",{className:"text-gray-400",children:t?new Date(t).toLocaleDateString():"—"})}];return e.jsx(I,{columns:l,data:s,emptyMessage:"No scrape jobs yet. Run your first scrape."})}function De({workerStatus:s}){return s?e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:s.workers&&Object.entries(s.workers).map(([l,t])=>e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-5 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(M,{color:ke[t.health]||"gray"}),e.jsx("span",{className:"text-sm font-medium capitalize text-gray-900",children:l.replace(/_/g," ")})]}),e.jsx("p",{className:"text-xs text-gray-400 font-mono",children:t.health==="unknown"?"No heartbeat":t.last_heartbeat?`Last: ${new Date(t.last_heartbeat).toLocaleTimeString()}`:"N/A"}),e.jsx("p",{className:`text-xs capitalize font-semibold mt-1 ${t.health==="healthy"?"text-emerald-700":t.health==="warning"?"text-amber-700":t.health==="unhealthy"?"text-red-700":"text-gray-500"}`,children:t.health})]},l))}),s.alerts&&e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3",children:"Alerts"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bounce Rate:"}),e.jsxs("span",{className:`text-sm font-mono font-medium ${s.alerts.bounce_rate_alert?"text-red-600":"text-emerald-600"}`,children:[s.alerts.bounce_rate||0,"%"]}),s.alerts.bounce_rate_alert&&e.jsx(v,{variant:"danger",size:"sm",children:"HIGH"})]})]})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Loading worker status..."})}function Ze(){const[s,l]=i.useState(null),[t,n]=i.useState(null),[u,a]=i.useState([]),[o,b]=i.useState(!0),[p,c]=i.useState("metrics"),[m,h]=i.useState(!1),[g,d]=i.useState({city:"",state:"",trade_type:"hvac"}),[E,R]=i.useState(!1),[J,L]=i.useState(!1),[S,F]=i.useState({city:"",state:""}),[q,H]=i.useState([]),[z,W]=i.useState(0),[$,X]=i.useState(1),[j,Y]=i.useState({status:"",trade_type:"",search:""}),[V,k]=i.useState(null),[Z,G]=i.useState([]),[K,Q]=i.useState(null),[B,O]=i.useState(null),T=async()=>{try{O(null);const[r,x,N]=await Promise.all([y.getSalesMetrics(),y.getSalesConfig(),y.getScrapeJobs()]);l(r),n(x),a(N.jobs||[])}catch(r){console.error("Failed to fetch sales engine data:",r),O(r.message||"Failed to load sales engine data. Please try again.")}finally{b(!1)}},C=i.useCallback(async()=>{try{const r={page:$,per_page:25};j.status&&(r.status=j.status),j.trade_type&&(r.trade_type=j.trade_type),j.search&&(r.search=j.search);const x=await y.getProspects(r);H(x.prospects||[]),W(x.total||0)}catch(r){console.error("Failed to fetch prospects:",r)}},[$,j]),ee=async()=>{try{const r=await y.getWorkerStatus();Q(r)}catch(r){console.error("Failed to fetch worker status:",r)}};i.useEffect(()=>{T()},[]),i.useEffect(()=>{p==="prospects"&&C()},[p,C]),i.useEffect(()=>{p==="status"&&ee()},[p]);const te=async()=>{try{await y.updateSalesConfig({is_active:!t.is_active}),n(r=>({...r,is_active:!r.is_active}))}catch(r){console.error("Failed to toggle sales engine:",r)}},se=async()=>{L(!0);try{await y.updateSalesConfig(t),await T()}catch(r){console.error("Failed to save config:",r)}finally{L(!1)}},ae=async()=>{if(!(!g.city||!g.state)){R(!0);try{await y.triggerScrapeJob(g),h(!1),d({city:"",state:"",trade_type:"hvac"}),await T()}catch(r){console.error("Scrape failed:",r)}finally{R(!1)}}},re=()=>{if(!t||!S.city||!S.state)return;const r=[...t.target_locations||[],{...S}];n(x=>({...x,target_locations:r})),F({city:"",state:""})},le=r=>{if(!t)return;const x=(t.target_locations||[]).filter((N,_)=>_!==r);n(N=>({...N,target_locations:x}))},ne=r=>{if(!t)return;const x=t.target_trade_types||[],N=x.includes(r)?x.filter(_=>_!==r):[...x,r];n(_=>({..._,target_trade_types:N}))},oe=async r=>{k(r);try{const x=await y.getProspectEmails(r.id);G(x.emails||[])}catch(x){console.error("Failed to fetch emails:",x)}},ce=async r=>{try{await y.deleteProspect(r),k(null),await C()}catch(x){console.error("Delete failed:",x)}},ie=async r=>{try{await y.blacklistProspect(r),k(null),await C()}catch(x){console.error("Blacklist failed:",x)}},de=[{id:"metrics",label:"Metrics"},{id:"prospects",label:"Prospects",count:z||void 0},{id:"scraping",label:"Scrape Jobs",count:u.length||void 0},{id:"status",label:"Status"},{id:"settings",label:"Settings"}];return o?e.jsxs("div",{className:"min-h-screen bg-[#FAFAFA]",children:[e.jsx("div",{className:"h-8 w-48 rounded-lg bg-gray-100 animate-pulse mb-6"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded-2xl animate-pulse"})]}):e.jsxs("div",{className:"min-h-screen bg-[#FAFAFA]",children:[e.jsx(pe,{title:"Sales Engine",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:te,className:`flex items-center gap-1.5 px-3 py-2 rounded-xl text-sm font-medium transition-all cursor-pointer ${t!=null&&t.is_active?"bg-emerald-50 text-emerald-700 border border-emerald-200/60":"bg-gray-50 text-gray-500 border border-gray-200"}`,children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),t!=null&&t.is_active?"Active":"Inactive"]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-1.5 px-4 py-2 rounded-xl text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 transition-colors cursor-pointer",children:[e.jsx(ye,{className:"w-4 h-4"}),"Run Scrape"]})]})}),B&&e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-3 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60 text-sm text-red-700",children:[e.jsx("span",{children:B}),e.jsx("button",{onClick:()=>{b(!0),T()},className:"shrink-0 px-3 py-1.5 rounded-lg text-xs font-medium text-red-700 bg-white border border-red-200 hover:bg-red-100 transition-colors cursor-pointer",children:"Retry"})]}),e.jsx(Te,{show:m,form:g,onChange:d,onSubmit:ae,onClose:()=>h(!1),scraping:E}),e.jsx(ue,{tabs:de,activeId:p,onChange:c}),p==="metrics"&&e.jsx(Ce,{metrics:s}),p==="prospects"&&e.jsx(Pe,{prospects:q,prospectsTotal:z,prospectsPage:$,prospectsFilter:j,onFilterChange:Y,onPageChange:X,selectedProspect:V,prospectEmails:Z,onSelectProspect:oe,onCloseDetail:()=>k(null),onDeleteProspect:ce,onBlacklistProspect:ie,maxSequenceSteps:t==null?void 0:t.max_sequence_steps}),p==="scraping"&&e.jsx($e,{scrapeJobs:u}),p==="status"&&e.jsx(De,{workerStatus:K}),p==="settings"&&e.jsx(ve,{config:t,onConfigChange:n,newLocation:S,onNewLocationChange:F,onAddLocation:re,onRemoveLocation:le,onToggleTradeType:ne,onSave:se,saving:J})]})}export{Ze as default};
