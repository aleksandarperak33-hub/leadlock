import{r as l,j as e,B as $,D as E,U as R}from"./index-BHeaMpcx.js";import{a as v}from"./client-CM7usSQg.js";import{P as B}from"./PageHeader-B70tmnmd.js";import{S as d}from"./StatCard-CoJTE6us.js";import{B as D}from"./Badge-CMg_OOW7.js";import{S as L}from"./StatusDot-BOoImejg.js";import{C as I}from"./clock-YShVbrww.js";const H=s=>{switch(s){case"active":return"success";case"trial":return"warning";case"past_due":return"danger";case"cancelled":return"danger";default:return"neutral"}},S=s=>s===0?"green":s<=5?"yellow":"red",o=["bg-orange-500","bg-orange-400","bg-orange-300","bg-gray-400"];function G(){var y,f,N;const[s,A]=l.useState(null),[t,w]=l.useState(null),[C,c]=l.useState(!0),[g,m]=l.useState(null),i=l.useCallback(async()=>{try{m(null);const[a,r]=await Promise.all([v.getAdminOverview(),v.getAdminHealth()]);A(a),w(r)}catch(a){console.error("Failed to fetch admin overview:",a),m(a.message||"Failed to load overview data. Please try again.")}finally{c(!1)}},[]);if(l.useEffect(()=>{i();const a=setInterval(i,3e4);return()=>clearInterval(a)},[i]),C)return e.jsxs("div",{className:"bg-[#FAFAFA] min-h-screen space-y-6",children:[e.jsx("div",{className:"h-7 w-48 rounded-lg bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((a,r)=>e.jsx("div",{className:"h-32 rounded-2xl bg-gray-100 animate-pulse"},r))}),e.jsx("div",{className:"h-64 rounded-2xl bg-gray-100 animate-pulse"})]});const x=(s==null?void 0:s.clients_by_tier)||{},b=(s==null?void 0:s.clients_by_billing)||{},u=Object.entries(x).sort((a,r)=>r[1]-a[1]),F=Object.values(x).reduce((a,r)=>a+r,0)||1,h=(t==null?void 0:t.error_count_24h)||0,p=((y=t==null?void 0:t.pending_integrations)==null?void 0:y.length)||0,j=((f=t==null?void 0:t.recent_errors)==null?void 0:f.length)||0,O=[{label:"Errors (24h)",value:h,color:S(h)},{label:"Pending Integrations",value:p,color:p>0?"yellow":"green"},{label:"Recent Errors",value:j,color:S(j)},{label:"Booked (30d)",value:(s==null?void 0:s.total_booked_30d)||0,color:"green"}];return e.jsxs("div",{className:"bg-[#FAFAFA] min-h-screen",children:[e.jsx(B,{title:"System Overview"}),g&&e.jsxs("div",{className:"mb-6 flex items-center justify-between gap-3 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60 text-sm text-red-700",children:[e.jsx("span",{children:g}),e.jsx("button",{onClick:()=>{c(!0),i()},className:"shrink-0 px-3 py-1.5 rounded-lg text-xs font-medium text-red-700 bg-white border border-red-200 hover:bg-red-100 transition-colors cursor-pointer",children:"Retry"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(d,{label:"Active Clients",value:(s==null?void 0:s.active_clients)??0,icon:$,color:"brand"}),e.jsx(d,{label:"Monthly Revenue",value:`$${((s==null?void 0:s.total_mrr)||0).toLocaleString()}`,deltaLabel:`${((N=s==null?void 0:s.clients_by_billing)==null?void 0:N.active)||0} paying`,icon:E,color:"green"}),e.jsx(d,{label:"Leads (30d)",value:(s==null?void 0:s.total_leads_30d)??0,deltaLabel:`${(s==null?void 0:s.total_leads_7d)||0} this week`,icon:R,color:"brand"}),e.jsx(d,{label:"Avg Response Time",value:s!=null&&s.avg_response_time_ms?`${(s.avg_response_time_ms/1e3).toFixed(1)}s`:"â€”",deltaLabel:`${(((s==null?void 0:s.conversion_rate)||0)*100).toFixed(1)}% conversion`,icon:I,color:"yellow"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-5",children:"Clients by Tier"}),e.jsxs("div",{className:"space-y-4",children:[u.map(([a,r],n)=>{const _=(r/F*100).toFixed(0),k=o[n]||o[o.length-1];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-sm font-medium capitalize text-gray-700",children:a}),e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:[r," (",_,"%)"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full bg-gray-100",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${k}`,style:{width:`${_}%`}})})]},a)}),u.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"No tier data"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-5",children:"Billing Status"}),e.jsxs("div",{className:"space-y-0.5",children:[Object.entries(b).sort((a,r)=>r[1]-a[1]).map(([a,r])=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 last:border-0",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(D,{variant:H(a),size:"sm",children:a.replace("_"," ")})}),e.jsx("span",{className:"text-sm font-mono font-medium text-gray-900",children:r})]},a)),Object.keys(b).length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"No billing data"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card lg:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-5",children:"System Health"}),t?e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:O.map(({label:a,value:r,color:n})=>e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-xl p-4 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{color:n}),e.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:a})]}),e.jsx("p",{className:`text-2xl font-bold font-mono ${n==="red"?"text-red-600":n==="yellow"?"text-amber-600":"text-gray-900"}`,children:r})]},a))}):e.jsx("p",{className:"text-sm text-gray-400",children:"Health data unavailable"})]})]})]})}export{G as default};
