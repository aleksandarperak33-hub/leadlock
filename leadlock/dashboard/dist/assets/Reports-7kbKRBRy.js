import{c as w,r as n,j as e,U as C,D as R}from"./index-C6CvHDG0.js";import{a as b}from"./client-BPQvj84Y.js";import{P as k}from"./PageHeader-BjaxPPSz.js";import{S as x}from"./StatCard-D4v_MXBs.js";import{C as E}from"./circle-alert-CQ0yiEZR.js";import{C as D}from"./calendar-check-BA-HEm-Y.js";import{C as F}from"./clock-_j4wTqy7.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=w("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),A={"0-10s":{value:"text-emerald-600",label:"text-emerald-600",bg:"bg-emerald-50",border:"border-emerald-100"},"10-30s":{value:"text-orange-600",label:"text-orange-600",bg:"bg-orange-50",border:"border-orange-100"},"30-60s":{value:"text-amber-600",label:"text-amber-600",bg:"bg-amber-50",border:"border-amber-100"}},L={value:"text-red-600"},O=[{id:"7d",label:"7 Days"},{id:"30d",label:"30 Days"},{id:"90d",label:"90 Days"},{id:"custom",label:"Custom"}];function V(){const[t,d]=n.useState(null),[r,a]=n.useState(!0),[o,m]=n.useState(null),[l,h]=n.useState("7d"),[i,y]=n.useState(""),[c,f]=n.useState(""),g=async()=>{a(!0);try{let s;if(l==="custom"&&i&&c)s=await b.getCustomReport(i,c);else if(l!=="custom")s=await b.getWeeklyReport(l==="7d"?void 0:l);else{a(!1);return}d(s),m(null)}catch(s){console.error("Failed to fetch report:",s),m(s.message||"Unknown error")}finally{a(!1)}};n.useEffect(()=>{g()},[l]);const j=()=>{i&&c&&g()};if(r&&!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 rounded-lg bg-gray-100 animate-pulse"}),e.jsx("div",{className:"h-96 rounded-xl bg-gray-100 animate-pulse"})]});const v=((t==null?void 0:t.total_ai_cost)??0)+((t==null?void 0:t.total_sms_cost)??0),u=((t==null?void 0:t.avg_response_time_ms)??0)>0||((t==null?void 0:t.total_leads)??0)>0,N=u?(((t==null?void 0:t.avg_response_time_ms)??0)/1e3).toFixed(1):"N/A",_=(((t==null?void 0:t.conversion_rate)??0)*100).toFixed(1),S=e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex rounded-xl p-1 bg-gray-100/80 border border-gray-200/50",children:O.map(s=>e.jsx("button",{onClick:()=>h(s.id),className:`px-3 py-1.5 text-xs font-semibold rounded-lg transition-all cursor-pointer ${l===s.id?"bg-white text-orange-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:s.label},s.id))}),e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium text-gray-600 bg-white border border-gray-200 shadow-sm hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx(P,{className:"w-4 h-4"}),"Print"]})]});return e.jsxs("div",{children:[e.jsx(k,{title:"Reports",actions:S}),l==="custom"&&e.jsxs("div",{className:"flex items-end gap-3 mb-6 p-4 bg-white border border-gray-200/50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-start",className:"text-xs font-medium text-gray-500 mb-1 block",children:"Start Date"}),e.jsx("input",{id:"report-start",type:"date",value:i,onChange:s=>y(s.target.value),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg outline-none focus:border-orange-300 focus:ring-2 focus:ring-orange-100"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-end",className:"text-xs font-medium text-gray-500 mb-1 block",children:"End Date"}),e.jsx("input",{id:"report-end",type:"date",value:c,onChange:s=>f(s.target.value),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg outline-none focus:border-orange-300 focus:ring-2 focus:ring-orange-100"})]}),e.jsx("button",{onClick:j,disabled:!i||!c,className:"px-5 py-2 rounded-lg text-sm font-medium bg-orange-500 hover:bg-orange-600 text-white disabled:opacity-50 transition-colors cursor-pointer",children:"Apply"})]}),o&&e.jsxs("div",{className:"mb-6 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60 text-red-600 text-sm flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 flex-shrink-0"}),"Failed to load report data. ",e.jsx("button",{onClick:()=>{m(null),g()},className:"underline font-medium cursor-pointer",children:"Retry"})]}),t&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(x,{label:"Total Leads",value:t.total_leads,icon:C,color:"brand"}),e.jsx(x,{label:"Booked",value:t.total_booked??0,deltaLabel:`${_}% conversion`,icon:D,color:"green"}),e.jsx(x,{label:"Avg Response Time",value:u?`${N}s`:"N/A",icon:F,color:"yellow"}),e.jsx(x,{label:"Total Cost",value:`$${v.toFixed(2)}`,deltaLabel:`AI: $${(t.total_ai_cost??0).toFixed(2)} | SMS: $${(t.total_sms_cost??0).toFixed(2)}`,icon:R,color:"brand"})]}),e.jsx(p,{title:"Leads by Source",entries:t.leads_by_source}),e.jsx(p,{title:"Leads by State",entries:t.leads_by_state}),e.jsx($,{buckets:t.response_time_distribution,totalLeads:t.total_leads})]})]})}function p({title:t,entries:d}){const r=Object.entries(d||{}).sort((a,o)=>o[1]-a[1]);return e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl shadow-card overflow-hidden",children:[e.jsx("div",{className:"px-6 pt-6 pb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50/80 border-b border-gray-200/50",children:[e.jsx("th",{scope:"col",className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.includes("Source")?"Source":"State"}),e.jsx("th",{scope:"col",className:"text-right px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Count"})]})}),e.jsxs("tbody",{children:[r.map(([a,o])=>e.jsxs("tr",{className:"border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-3.5 text-sm capitalize text-gray-600",children:a.replaceAll("_"," ")}),e.jsx("td",{className:"px-6 py-3.5 text-sm text-right font-mono font-medium text-gray-900",children:o})]},a)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"px-6 py-8 text-center text-sm text-gray-400",children:"No data available"})})]})]})]})}function $({buckets:t,totalLeads:d}){return!t||t.length===0?null:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Response Time Distribution"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:t.map(r=>{const a=A[r.bucket]||L,o=d>0?(r.count/d*100).toFixed(1):"0.0";return e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2",children:r.bucket}),e.jsx("p",{className:`text-2xl font-bold font-mono ${a.value}`,children:r.count}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[e.jsxs("span",{className:"font-mono",children:[o,"%"]})," of leads"]})]},r.bucket)})})]})}export{V as default};
