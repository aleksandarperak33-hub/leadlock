import{j as e,X as P,d as C,r as m,g as R,h as U}from"./index-BHeaMpcx.js";import{a as F}from"./client-CM7usSQg.js";import{P as I}from"./PageHeader-B70tmnmd.js";import{S as j}from"./StatCard-CoJTE6us.js";import{T as z}from"./Tabs-D_nwivGe.js";import{B as E}from"./Badge-CMg_OOW7.js";import{S as A}from"./StatusDot-BOoImejg.js";import{E as O}from"./EmptyState-OQFNGUqU.js";import{C as D}from"./clock-YShVbrww.js";import{s as u,f as N,U as b}from"./format-CVxTNEoV.js";import{M as V}from"./map-pin-HuyXKHLt.js";import{n as G,t as B}from"./en-US-8upN5vI8.js";import{C as k}from"./circle-alert-CrLVGEbj.js";import{C as H}from"./circle-check-CZ_JZGx6.js";function W(s,n,l){const[i,r]=G(l==null?void 0:l.in,s,n);return+u(i)==+u(r)}function M(s,n){return+B(s)<+B(n)}const Y={confirmed:"success",pending:"warning",cancelled:"danger",completed:"info"};function J({booking:s,onClose:n}){if(!s)return null;const l=new Date(s.appointment_date),i=Y[s.status]||"neutral",r=s.crm_sync_status==="synced"?"green":"yellow",c=s.crm_sync_status==="synced"?"Synced to CRM":"Pending sync";return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl max-w-md w-full border border-gray-200/50 animate-fade-up",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Booking Details"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 cursor-pointer","aria-label":"Close",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"px-6 py-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.service_type||"Service appointment"}),e.jsx(E,{variant:i,size:"sm",children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(C,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:N(l,"EEEE, MMMM d, yyyy")})]}),s.time_window_start&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"text-gray-700 font-mono",children:[s.time_window_start,s.time_window_end?` - ${s.time_window_end}`:""]})]}),s.tech_name&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(b,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:s.tech_name})]}),s.lead_name&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(b,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:s.lead_name}),s.phone_masked&&e.jsx("span",{className:"text-gray-400 font-mono text-xs",children:s.phone_masked})]}),s.address&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:s.address})]}),s.notes&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.notes})]}),s.crm_sync_status&&e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-100",children:[e.jsx(A,{color:r}),e.jsx("span",{className:"text-xs text-gray-400",children:c}),s.crm_job_id&&e.jsxs("span",{className:"text-xs font-mono text-gray-400 ml-auto",children:["Job #",s.crm_job_id]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-100 bg-gray-50/50 rounded-b-2xl",children:e.jsx("button",{onClick:n,className:"w-full px-4 py-2.5 rounded-xl text-sm font-medium text-gray-600 bg-white border border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer",children:"Close"})})]})]})}const X={confirmed:"success",pending:"warning",cancelled:"danger",completed:"info"},q={confirmed:"bg-emerald-500",pending:"bg-amber-500",cancelled:"bg-red-500",completed:"bg-blue-500"},K=[{id:"list",label:"List"},{id:"calendar",label:"Calendar"}];function he(){const[s,n]=m.useState([]),[l,i]=m.useState(!0),[r,c]=m.useState(null),[o,w]=m.useState("list"),[f,d]=m.useState(null);m.useEffect(()=>{x()},[]);const x=async()=>{try{const a=await F.getBookings();n(a.bookings||[]),c(null)}catch(a){console.error("Failed to load bookings:",a),c(a.message||"Unknown error")}finally{i(!1)}},g=u(new Date),y=s.filter(a=>{const p=u(new Date(a.appointment_date));return(W(p,g)||!M(p,g))&&a.status!=="cancelled"}),v=s.filter(a=>{const p=u(new Date(a.appointment_date));return M(p,g)||a.status==="cancelled"}),_=s.filter(a=>a.status==="confirmed").length,t=s.filter(a=>a.status==="pending").length;return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-6 h-6 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{children:[e.jsx(I,{title:"Bookings"}),r&&e.jsxs("div",{className:"mb-6 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60 text-red-600 text-sm flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 flex-shrink-0"}),"Failed to load bookings data. ",e.jsx("button",{onClick:()=>{c(null),x()},className:"underline font-medium cursor-pointer",children:"Retry"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(j,{label:"Total Bookings",value:s.length,icon:C,color:"brand"}),e.jsx(j,{label:"Upcoming",value:y.length,icon:D,color:"green"}),e.jsx(j,{label:"Confirmed",value:_,icon:H,color:"green"}),e.jsx(j,{label:"Pending",value:t,icon:k,color:"yellow"})]}),e.jsx(z,{tabs:K,activeId:o,onChange:w}),o==="list"&&e.jsx(Q,{upcoming:y,past:v,total:s.length,onBookingClick:d}),o==="calendar"&&e.jsx(Z,{bookings:s,onBookingClick:d}),f&&e.jsx(J,{booking:f,onClose:()=>d(null)})]})}function Q({upcoming:s,past:n,total:l,onBookingClick:i}){return l===0?e.jsx(O,{icon:C,title:"No bookings yet",description:"Bookings will appear here when leads are scheduled."}):e.jsxs("div",{children:[s.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3",children:"Upcoming"}),e.jsx("div",{className:"space-y-3",children:s.map(r=>e.jsx(T,{booking:r,onClick:()=>i(r)},r.id))})]}),n.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3",children:"Past"}),e.jsx("div",{className:"space-y-3",children:n.map(r=>e.jsx(T,{booking:r,onClick:()=>i(r)},r.id))})]})]})}function T({booking:s,onClick:n}){const l=new Date(s.appointment_date),i=X[s.status]||"neutral",r=s.crm_sync_status==="synced"?"green":"yellow",c=s.crm_sync_status==="synced"?"Synced":"Pending sync";return e.jsxs("div",{onClick:n,className:"flex items-center gap-4 bg-white border border-gray-200/50 rounded-xl p-5 hover:bg-gray-50/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"text-center w-14 flex-shrink-0",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase text-gray-400",children:N(l,"MMM")}),e.jsx("p",{className:"text-2xl font-bold font-mono leading-tight text-gray-900",children:N(l,"d")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium truncate text-gray-900",children:s.service_type||"Service appointment"}),e.jsx(E,{variant:i,size:"sm",children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[s.time_window_start&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-mono",children:[s.time_window_start," - ",s.time_window_end||"â€”"]})]}),s.tech_name&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(b,{className:"w-3 h-3"}),s.tech_name]})]})]}),s.crm_sync_status&&e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(A,{color:r}),e.jsx("span",{className:"text-xs text-gray-400",children:c})]})]})}function Z({bookings:s,onBookingClick:n}){const[l,i]=m.useState(new Date),r=new Date,c=l.getFullYear(),o=l.getMonth(),w=new Date(c,o,1).getDay(),f=new Date(c,o+1,0).getDate(),d={};s.forEach(t=>{const a=t.appointment_date;d[a]||(d[a]=[]),d[a].push(t)});const x=[];for(let t=0;t<w;t++)x.push(null);for(let t=1;t<=f;t++)x.push(t);const g=N(l,"MMMM yyyy"),y=()=>{i(new Date(c,o-1,1))},v=()=>{i(new Date(c,o+1,1))},_=t=>t===r.getDate()&&o===r.getMonth()&&c===r.getFullYear();return e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("button",{onClick:y,className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Previous month",children:e.jsx(R,{className:"w-4 h-4 text-gray-500"})}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:g}),e.jsx("button",{onClick:v,className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Next month",children:e.jsx(U,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"grid grid-cols-7",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"text-center text-[10px] font-medium uppercase tracking-wider py-2 text-gray-400",children:t},t)),x.map((t,a)=>{if(!t)return e.jsx("div",{className:"border border-gray-100 min-h-[80px]"},`empty-${a}`);const p=`${c}-${String(o+1).padStart(2,"0")}-${String(t).padStart(2,"0")}`,$=d[p]||[],S=_(t);return e.jsxs("div",{className:`border border-gray-100 min-h-[80px] p-1.5 ${S?"bg-orange-50/50 border-orange-200":""}`,children:[e.jsx("p",{className:`text-sm font-medium mb-1 ${S?"text-orange-600":"text-gray-600"}`,children:t}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:$.map(h=>{const L=q[h.status]||"bg-gray-300";return e.jsx("button",{onClick:()=>n(h),className:`w-[6px] h-[6px] rounded-full ${L} cursor-pointer hover:scale-150 transition-transform`,title:`${h.service_type||"Appointment"} (${h.status})`,"aria-label":`Booking: ${h.service_type||"Appointment"}`},h.id)})})]},t)})]})]})}export{he as default};
