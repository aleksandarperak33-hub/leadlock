import{A as m}from"./index-C6CvHDG0.js";const h="/api/v1/dashboard",f="/api/v1/admin",T="/api/v1/sales",S=1e4,P=3600*1e3;let p=null;function O(){Object.values(m).forEach(e=>localStorage.removeItem(e)),window.location.href="/login"}function b(e){try{const t=e.split(".");return t.length!==3?null:JSON.parse(atob(t[1].replace(/-/g,"+").replace(/_/g,"/")))}catch{return null}}async function w(){const e=localStorage.getItem(m.TOKEN);if(!e)return;const t=b(e);if(!(t!=null&&t.exp))return;const r=t.exp*1e3,n=Date.now();if(!(r-n>P)){if(p){await p.catch(()=>{});return}p=(async()=>{try{const i=await fetch("/api/v1/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!i.ok)return;const l=await i.json();l.token&&localStorage.setItem(m.TOKEN,l.token)}catch{}finally{p=null}})(),await p.catch(()=>{})}}function u(e){return async function(r,n={}){await w();const i=localStorage.getItem(m.TOKEN),l=new AbortController,y=setTimeout(()=>l.abort(),S);try{const c=await fetch(`${e}${r}`,{...n,signal:l.signal,headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{},...n.headers}});if(c.status===401)throw console.warn("API returned 401, clearing session"),O(),new Error("Unauthorized");if(c.status===403)throw new Error("Admin access required");if(!c.ok){const $=await c.json().catch(()=>({detail:"Request failed"}));throw new Error($.detail||`HTTP ${c.status}`)}return c.json()}finally{clearTimeout(y)}}}const A="/api/v1/analytics",E="/api/v1/agents",s=u(h),o=u(f),a=u(T),g=u(A),d=u(E),C={login:(e,t)=>fetch("/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(r=>{if(!r.ok)throw new Error("Invalid credentials");return r.json()}),gmbLookup:e=>{const t=new AbortController,r=setTimeout(()=>t.abort(),S);return fetch("/api/v1/auth/gmb-lookup",{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})}).then(async n=>{if(!n.ok){const i=await n.json().catch(()=>({detail:"Lookup failed"}));throw new Error(i.detail||`HTTP ${n.status}`)}return n.json()}).finally(()=>clearTimeout(r))},getMetrics:(e="7d")=>s(`/metrics?period=${e}`),getROI:(e="30d")=>s(`/roi?period=${e}`),getLeads:(e={})=>{const t=new URLSearchParams(e).toString();return s(`/leads?${t}`)},getLead:e=>s(`/leads/${e}`),getConversations:e=>s(`/leads/${e}/conversations`),getActivity:(e=50)=>s(`/activity?limit=${e}`),getWeeklyReport:e=>s(`/reports/weekly${e?`?week=${e}`:""}`),getSettings:()=>s("/settings"),updateSettings:e=>s("/settings",{method:"PUT",body:JSON.stringify(e)}),getComplianceSummary:()=>s("/compliance/summary"),updateLeadStatus:(e,t)=>s(`/leads/${e}/status`,{method:"PUT",body:JSON.stringify({status:t})}),archiveLead:(e,t)=>s(`/leads/${e}/archive`,{method:"PUT",body:JSON.stringify({archived:t})}),updateLeadTags:(e,t)=>s(`/leads/${e}/tags`,{method:"PUT",body:JSON.stringify({tags:t})}),updateLeadNotes:(e,t)=>s(`/leads/${e}/notes`,{method:"PUT",body:JSON.stringify({notes:t})}),sendReply:(e,t)=>s(`/leads/${e}/reply`,{method:"POST",body:JSON.stringify({message:t})}),getBookings:(e={})=>{const t=new URLSearchParams(e).toString();return s(`/bookings?${t}`)},getCustomReport:(e,t)=>s(`/reports/custom?start=${e}&end=${t}`),exportLeadsCSV:()=>{const e=localStorage.getItem(m.TOKEN);return fetch(`${h}/leads/export?format=csv`,{headers:e?{Authorization:`Bearer ${e}`}:{}}).then(t=>{if(!t.ok)throw new Error("Export failed");return t.blob()})},getComplianceDetails:e=>s(`/compliance/details?type=${e}`),getAdminOverview:()=>o("/overview"),getAdminClients:(e={})=>{const t=new URLSearchParams(e).toString();return o(`/clients?${t}`)},getAdminClient:e=>o(`/clients/${e}`),getAdminLeads:(e={})=>{const t=new URLSearchParams(e).toString();return o(`/leads?${t}`)},getAdminRevenue:(e="30d")=>o(`/revenue?period=${e}`),getAdminHealth:()=>o("/health"),getAdminOutreach:(e={})=>{const t=new URLSearchParams(e).toString();return o(`/outreach?${t}`)},createOutreach:e=>o("/outreach",{method:"POST",body:JSON.stringify(e)}),updateOutreach:(e,t)=>o(`/outreach/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteOutreach:e=>o(`/outreach/${e}`,{method:"DELETE"}),convertOutreach:e=>o(`/outreach/${e}/convert`,{method:"POST"}),createAdminClient:e=>o("/clients",{method:"POST",body:JSON.stringify(e)}),getSalesConfig:()=>a("/config"),updateSalesConfig:e=>a("/config",{method:"PUT",body:JSON.stringify(e)}),getSalesMetrics:(e="30d")=>a(`/metrics?period=${e}`),getScrapeJobs:(e=1)=>a(`/scrape-jobs?page=${e}`),triggerScrapeJob:e=>a("/scrape-jobs",{method:"POST",body:JSON.stringify(e)}),getProspects:(e={})=>{const t=new URLSearchParams(e).toString();return a(`/prospects?${t}`)},getProspect:e=>a(`/prospects/${e}`),updateProspect:(e,t)=>a(`/prospects/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteProspect:e=>a(`/prospects/${e}`,{method:"DELETE"}),createProspect:e=>a("/prospects",{method:"POST",body:JSON.stringify(e)}),blacklistProspect:e=>a(`/prospects/${e}/blacklist`,{method:"POST"}),getProspectEmails:e=>a(`/prospects/${e}/emails`),getWorkerStatus:()=>a("/worker-status"),pauseWorker:e=>a(`/workers/${e}/pause`,{method:"POST"}),resumeWorker:e=>a(`/workers/${e}/resume`,{method:"POST"}),getCampaigns:(e={})=>{const t=new URLSearchParams(e).toString();return a(`/campaigns?${t}`)},getCampaign:e=>a(`/campaigns/${e}`),createCampaign:e=>a("/campaigns",{method:"POST",body:JSON.stringify(e)}),updateCampaign:(e,t)=>a(`/campaigns/${e}`,{method:"PUT",body:JSON.stringify(t)}),pauseCampaign:e=>a(`/campaigns/${e}/pause`,{method:"POST"}),resumeCampaign:e=>a(`/campaigns/${e}/resume`,{method:"POST"}),getCampaignDetail:e=>a(`/campaigns/${e}/detail`),getCampaignProspects:(e,t={})=>{const r=new URLSearchParams(t).toString();return a(`/campaigns/${e}/prospects?${r}`)},activateCampaign:e=>a(`/campaigns/${e}/activate`,{method:"POST"}),assignProspects:(e,t)=>a(`/campaigns/${e}/assign-prospects`,{method:"POST",body:JSON.stringify(t)}),getCampaignMetrics:e=>a(`/campaigns/${e}/metrics`),getInbox:(e={})=>{const t=new URLSearchParams(e).toString();return a(`/inbox?${t}`)},getInboxThread:e=>a(`/inbox/${e}/thread`),getTemplates:()=>a("/templates"),createTemplate:e=>a("/templates",{method:"POST",body:JSON.stringify(e)}),updateTemplate:(e,t)=>a(`/templates/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteTemplate:e=>a(`/templates/${e}`,{method:"DELETE"}),getCommandCenter:()=>a("/command-center"),getInsights:()=>a("/insights"),bulkUpdateProspects:e=>a("/prospects/bulk",{method:"POST",body:JSON.stringify(e)}),getAnalyticsFunnel:e=>g(`/funnel${e?`?trade=${e}`:""}`),getAnalyticsCostPerLead:e=>g(`/cost-per-lead${e?`?trade=${e}`:""}`),getAnalyticsEmailPerf:()=>g("/email-performance"),getAnalyticsAbTests:()=>g("/ab-tests"),getAnalyticsPipeline:()=>g("/pipeline"),getAnalyticsAgentCosts:(e=7)=>g(`/agent-costs?days=${e}`),getAgentFleet:()=>d("/fleet"),getAgentActivity:(e,t=20)=>d(`/${e}/activity?limit=${t}`),getAgentTasks:(e={})=>{const t=new URLSearchParams(e).toString();return d(`/tasks?${t}`)},getAgentCosts:(e="7d")=>d(`/costs?period=${e}`),getSystemMap:()=>d("/system-map"),getActivityFeed:(e={})=>{const t=new URLSearchParams(e).toString();return d(`/activity-feed?${t}`)}};export{C as a};
