import{c as T,j as e,C as X,r as p,P as Y,U as B,T as P}from"./index-C6CvHDG0.js";import{a as w}from"./client-BPQvj84Y.js";import{C as A,a as m,T as O,B as $,b as z,S,c as U}from"./CartesianGrid-CIzcP8ZR.js";import{r as G}from"./response-time-DYhTzzae.js";import{P as H}from"./PageHeader-BjaxPPSz.js";import{S as N}from"./StatCard-D4v_MXBs.js";import{E as W}from"./EmptyState-BehFkc_W.js";import{R,X as I,Y as E,T as F,B as K,C as V}from"./generateCategoricalChart-BLJf6WDd.js";import{B as q}from"./BarChart-DXGtnLxO.js";import{C as J}from"./circle-alert-CQ0yiEZR.js";import{C as Q}from"./calendar-check-BA-HEm-Y.js";import{C as Z}from"./clock-_j4wTqy7.js";import{A as ee,a as M}from"./AreaChart-C48c35vs.js";import{A as se}from"./activity-BVxI_7oA.js";import{t as y,c as te,n as D,g as C,e as ae,m as L,a as _,b as re}from"./en-US-8upN5vI8.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=T("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=T("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);function le({data:a=[]}){return a.length===0?e.jsx(W,{icon:X,title:"No response time data",description:"Response time distribution will appear here once leads are received."}):e.jsx(R,{width:"100%",height:280,children:e.jsxs(q,{data:a,margin:{top:4,right:4,bottom:0,left:-20},children:[e.jsx(A,{stroke:m.grid,vertical:!1,strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"bucket",tick:{fill:m.axis,fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(E,{tick:{fill:m.axis,fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(F,{contentStyle:O,cursor:{fill:"#f9fafb"}}),e.jsx(K,{dataKey:"count",radius:[4,4,0,0],children:a.map((r,s)=>e.jsx(V,{fill:$[r.bucket]||z[500],fillOpacity:.9},s))})]})})}const oe={google_lsa:"Google LSA",angi:"Angi",facebook:"Facebook",website:"Website",missed_call:"Missed Call",text_in:"Text-In",thumbtack:"Thumbtack",referral:"Referral",yelp:"Yelp"};function ce({data:a={}}){const r=Object.entries(a).sort((t,o)=>o[1]-t[1]),s=Math.max(...r.map(([,t])=>t),1),i=r.reduce((t,[,o])=>t+o,0);return r.length?e.jsx("div",{className:"space-y-4",children:r.map(([t,o],d)=>{const n=i>0?(o/i*100).toFixed(0):0,f=S[d%S.length];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1.5",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:oe[t]||t}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:[n,"%"]}),e.jsx("span",{className:"text-sm font-mono font-semibold text-gray-900",children:o})]})]}),e.jsx("div",{className:"w-full rounded-lg h-2 bg-gray-100 overflow-hidden",children:e.jsx("div",{className:"h-2 rounded-lg transition-all duration-700 ease-out",style:{width:`${o/s*100}%`,background:f}})})]},t)})}):e.jsx("p",{className:"text-sm text-gray-400 py-8 text-center",children:"No data available"})}function de({label:a="System Active"}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75 animate-[live-pulse_2s_ease-in-out_infinite]"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:a})]})}function k(a,r){const s=+y(a)-+y(r);return s<0?-1:s>0?1:s}function me(a){return te(a,Date.now())}function fe(a,r,s){const[i,t]=D(s==null?void 0:s.in,a,r),o=i.getFullYear()-t.getFullYear(),d=i.getMonth()-t.getMonth();return o*12+d}function ue(a){return r=>{const i=(a?Math[a]:Math.trunc)(r);return i===0?0:i}}function xe(a,r){return+y(a)-+y(r)}function he(a,r){const s=y(a,r==null?void 0:r.in);return s.setHours(23,59,59,999),s}function ge(a,r){const s=y(a,r==null?void 0:r.in),i=s.getMonth();return s.setFullYear(s.getFullYear(),i+1,0),s.setHours(23,59,59,999),s}function ye(a,r){const s=y(a,r==null?void 0:r.in);return+he(s,r)==+ge(s,r)}function be(a,r,s){const[i,t,o]=D(s==null?void 0:s.in,a,a,r),d=k(t,o),n=Math.abs(fe(t,o));if(n<1)return 0;t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-d*n);let f=k(t,o)===-d;ye(i)&&n===1&&k(i,o)===1&&(f=!1);const u=d*(n-+f);return u===0?0:u}function je(a,r,s){const i=xe(a,r)/1e3;return ue(s==null?void 0:s.roundingMethod)(i)}function pe(a,r,s){const i=re(),t=(s==null?void 0:s.locale)??i.locale??ae,o=2520,d=k(a,r);if(isNaN(d))throw new RangeError("Invalid time value");const n=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:d}),[f,u]=D(s==null?void 0:s.in,...d>0?[r,a]:[a,r]),x=je(u,f),v=(C(u)-C(f))/1e3,c=Math.round((x-v)/60);let g;if(c<2)return s!=null&&s.includeSeconds?x<5?t.formatDistance("lessThanXSeconds",5,n):x<10?t.formatDistance("lessThanXSeconds",10,n):x<20?t.formatDistance("lessThanXSeconds",20,n):x<40?t.formatDistance("halfAMinute",0,n):x<60?t.formatDistance("lessThanXMinutes",1,n):t.formatDistance("xMinutes",1,n):c===0?t.formatDistance("lessThanXMinutes",1,n):t.formatDistance("xMinutes",c,n);if(c<45)return t.formatDistance("xMinutes",c,n);if(c<90)return t.formatDistance("aboutXHours",1,n);if(c<L){const h=Math.round(c/60);return t.formatDistance("aboutXHours",h,n)}else{if(c<o)return t.formatDistance("xDays",1,n);if(c<_){const h=Math.round(c/L);return t.formatDistance("xDays",h,n)}else if(c<_*2)return g=Math.round(c/_),t.formatDistance("aboutXMonths",g,n)}if(g=be(u,f),g<12){const h=Math.round(c/_);return t.formatDistance("xMonths",h,n)}else{const h=g%12,b=Math.trunc(g/12);return h<3?t.formatDistance("aboutXYears",b,n):h<9?t.formatDistance("overXYears",b,n):t.formatDistance("almostXYears",b+1,n)}}function ve(a,r){return pe(a,me(a),r)}const Ne=[{id:"7d",label:"7d"},{id:"30d",label:"30d"},{id:"90d",label:"90d"}],_e={booking_confirmed:"bg-emerald-500",lead_created:"bg-orange-500",opt_out:"bg-red-500"};function Ye(){var b;const[a,r]=p.useState("7d"),[s,i]=p.useState(null),[t,o]=p.useState([]),[d,n]=p.useState(!0),[f,u]=p.useState(null),x=async()=>{try{const[l,j]=await Promise.all([w.getMetrics(a),w.getActivity(20)]);i(l),o(j),u(null)}catch(l){console.error("Failed to fetch dashboard data:",l),u(l.message||"Unknown error")}finally{n(!1)}};p.useEffect(()=>{n(!0),x();const l=setInterval(x,Y.DASHBOARD);return()=>clearInterval(l)},[a]);const v=s&&(s.avg_response_time_ms>0||s.total_leads>0),c=s&&v?(s.avg_response_time_ms/1e3).toFixed(1):"—",g=v?G(s.avg_response_time_ms):"brand";if(d&&!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 w-40 rounded-lg bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((l,j)=>e.jsx("div",{className:"h-32 rounded-2xl bg-white border border-gray-200/50 animate-pulse"},j))})]});const h=e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(de,{}),e.jsx("div",{className:"flex rounded-xl p-1 bg-gray-100/80 border border-gray-200/50",children:Ne.map(l=>e.jsx("button",{onClick:()=>r(l.id),className:`px-3.5 py-1.5 text-xs font-semibold rounded-lg transition-all cursor-pointer ${a===l.id?"bg-white text-orange-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:l.label},l.id))})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{title:"Overview",actions:h}),f&&e.jsxs("div",{className:"mb-6 px-4 py-3 rounded-xl bg-red-50 border border-red-200/60 text-red-600 text-sm flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 flex-shrink-0"}),"Failed to load dashboard data. ",e.jsx("button",{onClick:()=>{u(null),x()},className:"underline font-medium cursor-pointer",children:"Retry"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(N,{label:"Total Leads",value:(s==null?void 0:s.total_leads)??"—",icon:B,color:"brand"}),e.jsx(N,{label:"Booked",value:(s==null?void 0:s.total_booked)??"—",deltaLabel:s?`${(s.conversion_rate*100).toFixed(1)}% conversion`:void 0,icon:Q,color:"green"}),e.jsx(N,{label:"Avg Response",value:v?`${c}s`:"—",icon:U,color:g}),e.jsx(N,{label:"Under 60s",value:s?`${s.leads_under_60s_pct.toFixed(0)}%`:"—",deltaLabel:s?`${s.leads_under_60s} of ${s.total_leads}`:"",icon:ie,color:"green"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-400",strokeWidth:1.75}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Response Time Distribution"})]}),e.jsx(le,{data:(s==null?void 0:s.response_time_distribution)||[]})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400",strokeWidth:1.75}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Leads by Source"})]}),e.jsx(ce,{data:(s==null?void 0:s.leads_by_source)||{}})]})]}),((b=s==null?void 0:s.leads_by_day)==null?void 0:b.length)>0&&e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(P,{className:"w-4 h-4 text-gray-400",strokeWidth:1.75}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Leads Per Day"})]}),e.jsx("div",{className:"h-56",children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(ee,{data:s.leads_by_day,margin:{top:0,right:0,bottom:0,left:-20},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"leadGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:m.gradientStart,stopOpacity:.12}),e.jsx("stop",{offset:"95%",stopColor:m.gradientStart,stopOpacity:0})]})}),e.jsx(A,{strokeDasharray:"3 3",stroke:m.grid,vertical:!1}),e.jsx(I,{dataKey:"date",tick:{fill:m.axis,fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(E,{tick:{fill:m.axis,fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(F,{contentStyle:O,cursor:{stroke:m.cursor}}),e.jsx(M,{type:"monotone",dataKey:"count",stroke:m.stroke.primary,fill:"url(#leadGradient)",strokeWidth:2}),e.jsx(M,{type:"monotone",dataKey:"booked",stroke:m.stroke.secondary,fill:"none",strokeWidth:1.5,strokeDasharray:"4 4"})]})})})]}),e.jsxs("div",{className:"bg-white border border-gray-200/50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400",strokeWidth:1.75}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Recent Activity"})]}),e.jsxs("div",{className:"space-y-0.5 max-h-80 overflow-y-auto",children:[t.length===0&&e.jsx("p",{className:"text-sm text-gray-400 py-4",children:"No recent activity"}),t.map((l,j)=>e.jsxs("div",{className:"flex items-start gap-3 text-sm py-2.5 rounded-lg hover:bg-gray-50/50 px-3 -mx-3 transition-colors group",children:[e.jsxs("div",{className:"relative flex-shrink-0 mt-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${_e[l.type]||"bg-gray-300"}`}),j<t.length-1&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-px h-6 bg-gray-200"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-gray-600 group-hover:text-gray-900 transition-colors",children:l.message}),e.jsx("p",{className:"text-xs mt-0.5 text-gray-400",children:ve(new Date(l.timestamp),{addSuffix:!0})})]})]},l.id||`${l.type}-${l.timestamp}-${j}`))]})]})]})}export{Ye as default};
