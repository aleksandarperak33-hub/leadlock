import{r as u,j as e,U as H,D as P,C as A,T as z,Z as V}from"./index-C6CvHDG0.js";import{a as G}from"./client-BPQvj84Y.js";import{c as Q,C as v,a as n,T as N,S as K}from"./CartesianGrid-CIzcP8ZR.js";import{P as _}from"./PageHeader-BjaxPPSz.js";import{S as m}from"./StatCard-D4v_MXBs.js";import{F as W}from"./FunnelChart-AW39A6X6.js";import{T as M}from"./target-iFJKvwWf.js";import{R as k,X as w,Y as S,T as C,B as j,C as q,L as X}from"./generateCategoricalChart-BLJf6WDd.js";import{B as R}from"./BarChart-DXGtnLxO.js";import{C as Z}from"./clock-_j4wTqy7.js";import{F as J}from"./flask-conical-CMHnCdj6.js";const ee=[{id:"7d",label:"7 Days"},{id:"30d",label:"30 Days"},{id:"90d",label:"90 Days"},{id:"all",label:"All Time"}],se={google_lsa:"#4285f4",angi:"#00b050",facebook:"#1877f2",website:"#f97316",missed_call:"#8b5cf6",text_in:"#06b6d4",thumbtack:"#0fba81",yelp:"#d32323",referral:"#ec4899"};function d(r){return r>=1e3?`$${(r/1e3).toFixed(1)}k`:`$${r.toFixed(0)}`}function g(r){return`${(r*100).toFixed(1)}%`}function c({title:r,icon:p,children:t,className:b=""}){return e.jsxs("div",{className:`bg-white border border-gray-200/50 rounded-2xl shadow-card overflow-hidden ${b}`,children:[r&&e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center gap-2.5",children:[p&&e.jsx(p,{className:"w-4.5 h-4.5 text-orange-500",strokeWidth:1.75}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:r})]}),e.jsx("div",{className:"p-6",children:t})]})}function ge(){var D,O,E,I;const[r,p]=u.useState("30d"),[t,b]=u.useState(null),[U,$]=u.useState(!0),[L,T]=u.useState(null);if(u.useEffect(()=>{$(!0),G.getROI(r).then(s=>{b(s),T(null)}).catch(s=>T(s.message||"Failed to load ROI data")).finally(()=>$(!1))},[r]),U&&!t)return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx(_,{title:"ROI Dashboard",subtitle:"Loading your performance data..."}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-3 border-orange-200 border-t-orange-500 rounded-full animate-spin"})})]});if(L&&!t)return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx(_,{title:"ROI Dashboard"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-700 text-sm",children:L})})]});const l=(t==null?void 0:t.hero_kpis)||{},o=(t==null?void 0:t.funnel)||{},h=(t==null?void 0:t.revenue_by_source)||[],F=(t==null?void 0:t.revenue_by_month)||[],x=(t==null?void 0:t.per_lead_economics)||{},B=(t==null?void 0:t.response_time_distribution)||[],f=(t==null?void 0:t.qualify_variant_performance)||[],y=l.roi_multiplier>10;return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsx(_,{title:"ROI Dashboard",subtitle:"Your investment is working. Here's the proof.",actions:e.jsx("div",{className:"flex gap-1.5 bg-gray-100 rounded-xl p-1",children:ee.map(s=>e.jsx("button",{onClick:()=>p(s.id),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${r===s.id?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:s.label},s.id))})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(m,{label:"Total Leads",value:((D=l.total_leads)==null?void 0:D.toLocaleString())||"0",icon:H,color:"brand"}),e.jsx(m,{label:"Booking Rate",value:g(l.booking_rate||0),icon:M,color:"green"}),e.jsx(m,{label:"Est. Revenue",value:d(l.estimated_revenue||0),icon:P,color:"green"}),e.jsx(m,{label:"Cost / Booked Lead",value:`$${(l.cost_per_booked_lead||0).toFixed(2)}`,icon:A,color:"blue"}),e.jsx("div",{className:y?"animate-pulse":"",children:e.jsx(m,{label:"ROI Multiplier",value:`${(l.roi_multiplier||0).toFixed(1)}x`,icon:z,color:y?"green":"brand",deltaLabel:y?"Crushing it":void 0})}),e.jsx(m,{label:"Avg Response",value:`${(l.avg_response_time_seconds||0).toFixed(1)}s`,icon:Q,color:l.avg_response_time_seconds<10?"green":"yellow",deltaLabel:`${g(l.leads_under_10s||0)} under 10s`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c,{title:"Revenue by Source",icon:A,children:h.length>0?e.jsx(k,{width:"100%",height:300,children:e.jsxs(R,{data:h,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:n.grid}),e.jsx(w,{dataKey:"source",tick:{fill:n.axis,fontSize:11},tickFormatter:s=>s.replace(/_/g," ")}),e.jsx(S,{tick:{fill:n.axis,fontSize:11},tickFormatter:d}),e.jsx(C,{contentStyle:N,formatter:(s,a)=>[a==="revenue"?d(s):s,a]}),e.jsx(j,{dataKey:"revenue",radius:[6,6,0,0],children:h.map((s,a)=>e.jsx(q,{fill:se[s.source]||K[a%K.length]},a))})]})}):e.jsx("p",{className:"text-sm text-gray-400 text-center py-12",children:"No source data yet"})}),e.jsxs(c,{title:"Lead Funnel",icon:M,children:[e.jsx(W,{data:o}),e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-3",children:[{label:"Intake Rate",val:o.intake_sent,base:o.new},{label:"Qualify Rate",val:o.qualified,base:o.qualifying||o.intake_sent},{label:"Book Rate",val:o.booked,base:o.qualified||o.booking}].map(({label:s,val:a,base:i})=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider",children:s}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i>0?g((a||0)/i):"--"})]},s))})]})]}),F.length>1&&e.jsx(c,{title:"Revenue Trend",icon:z,children:e.jsx(k,{width:"100%",height:280,children:e.jsxs(R,{data:F,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:n.grid}),e.jsx(w,{dataKey:"month",tick:{fill:n.axis,fontSize:11}}),e.jsx(S,{tick:{fill:n.axis,fontSize:11},tickFormatter:d}),e.jsx(C,{contentStyle:N,formatter:(s,a)=>[a==="revenue"?d(s):s,a]}),e.jsx(X,{}),e.jsx(j,{dataKey:"revenue",fill:"#f97316",radius:[6,6,0,0],name:"Revenue"}),e.jsx(j,{dataKey:"leads",fill:"#fdba74",radius:[6,6,0,0],name:"Leads"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c,{title:"Per-Lead Economics",icon:P,children:e.jsxs("div",{className:"space-y-4",children:[[{label:"SMS Cost / Lead",value:`$${((O=x.avg_sms_cost)==null?void 0:O.toFixed(3))||"0.000"}`},{label:"AI Cost / Lead",value:`$${((E=x.avg_ai_cost)==null?void 0:E.toFixed(3))||"0.000"}`},{label:"Total Cost / Lead",value:`$${((I=x.avg_total_cost)==null?void 0:I.toFixed(3))||"0.000"}`,bold:!0},{label:"Avg Job Value",value:d(x.avg_job_value||0)}].map(({label:s,value:a,bold:i})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:s}),e.jsx("span",{className:`text-sm ${i?"font-bold text-gray-900":"font-medium text-gray-700"}`,children:a})]},s)),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2 uppercase tracking-wider",children:"Cost vs Revenue per Lead"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 bg-gray-100 rounded-full h-6 overflow-hidden relative",children:[e.jsx("div",{className:"bg-emerald-500 h-full rounded-full",style:{width:"100%"}}),e.jsx("div",{className:"absolute top-0 left-0 bg-red-400 h-full rounded-full",style:{width:`${Math.min((x.cost_to_revenue_ratio||0)*100,5)}%`,minWidth:"2px"}})]}),e.jsxs("span",{className:"text-xs font-mono text-gray-500 whitespace-nowrap",children:[((x.cost_to_revenue_ratio||0)*100).toFixed(3),"%"]})]}),e.jsxs("div",{className:"flex gap-4 mt-1.5 text-[10px] text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-400"})," Cost"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"})," Revenue"]})]})]})]})}),e.jsx(c,{title:"Source Performance",icon:V,children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[h.map(s=>{const a=s.leads>0?s.booked/s.leads:0,i=a>.6?"border-l-emerald-500":a>.3?"border-l-orange-400":"border-l-red-400";return e.jsxs("div",{className:`bg-gray-50 rounded-xl p-3.5 border-l-4 ${i}`,children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 capitalize",children:s.source.replace(/_/g," ")}),e.jsx("p",{className:"text-lg font-bold text-gray-900 mt-1",children:s.leads}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-400",children:["Book: ",g(a)]}),e.jsx("span",{className:"text-[10px] font-medium text-emerald-600",children:d(s.revenue)})]})]},s.source)}),h.length===0&&e.jsx("p",{className:"text-sm text-gray-400 text-center col-span-2 py-8",children:"No source data yet"})]})})]}),e.jsxs(c,{title:"Response Time Impact",icon:Z,children:[e.jsx(k,{width:"100%",height:250,children:e.jsxs(R,{data:B,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(v,{strokeDasharray:"3 3",stroke:n.grid}),e.jsx(w,{dataKey:"bucket",tick:{fill:n.axis,fontSize:11}}),e.jsx(S,{tick:{fill:n.axis,fontSize:11}}),e.jsx(C,{contentStyle:N}),e.jsx(j,{dataKey:"count",radius:[6,6,0,0],children:B.map((s,a)=>{const i={"0-5s":"#10b981","5-10s":"#fb923c","10-30s":"#f59e0b","30s+":"#ef4444"};return e.jsx(q,{fill:i[s.bucket]||"#f97316"},a)})})]})}),l.leads_under_10s>0&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-bold text-emerald-600",children:g(l.leads_under_10s)})," of leads responded to in under 10 seconds"]})})]}),f.length>0&&e.jsxs(c,{title:"Qualify Prompt A/B Test",icon:J,children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Variant"}),e.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Leads"}),e.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Booked"}),e.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Booking Rate"}),e.jsx("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Performance"})]})}),e.jsx("tbody",{children:f.map(s=>{const a=Math.max(...f.map(Y=>Y.rate)),i=s.rate===a&&s.rate>0;return e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50/50",children:[e.jsxs("td",{className:"py-3 px-3 font-medium text-gray-900",children:["Variant ",s.variant,i&&e.jsx("span",{className:"ml-2 text-[10px] bg-emerald-50 text-emerald-600 px-1.5 py-0.5 rounded-full font-semibold",children:"BEST"})]}),e.jsx("td",{className:"py-3 px-3 text-right text-gray-600",children:s.leads}),e.jsx("td",{className:"py-3 px-3 text-right text-gray-600",children:s.booked}),e.jsx("td",{className:"py-3 px-3 text-right font-bold text-gray-900",children:g(s.rate)}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2.5",children:e.jsx("div",{className:`h-2.5 rounded-full ${i?"bg-emerald-500":"bg-orange-400"}`,style:{width:`${Math.max(s.rate*100,2)}%`}})})})]},s.variant)})})]})}),f.length>1&&e.jsx("p",{className:"text-xs text-gray-400 mt-3 text-center",children:"Deterministic assignment via lead ID hash. Statistical significance requires 100+ leads per variant."})]})]})}export{ge as default};
